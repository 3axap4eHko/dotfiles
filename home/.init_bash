#!/usr/bin/env bash

# dotfiles
. ~/.exports
. ~/.aliases
. ~/.functions

# Full prompt
PS1='\[\e]0;\w\a\]${debian_chroot:+($debian_chroot)}'
PS1+='$(prmt --shell bash --code $? "{path:#89dceb}{node:#a6e3a1:f: [:]}{rust:#f38ba8:f: ü¶Ä}{git:#f9e2af:f: }\n{ok:#a6e3a1}{fail:#f38ba8} ")'

function lastcommand {
    history | tail -1 | cut -c 8-
}

function deleteprompt {
    n=${PS1@P}
    n=${n//[^$'\n']}
    n=${#n}
    tput cuu $((n + 1))
    tput ed
}

function prompt_indicator {
    prmt --shell bash --code ${1:-0} "{ok:#a6e3a1:‚ùØ}{fail:#f38ba8:‚ùØ}"
}

PS0='\[$(deleteprompt)\]$(prompt_indicator ${LAST_EXIT_CODE}) $(lastcommand)\n\[${PS1:0:$((EXPS0=1,0))}\]'
PROMPT_COMMAND='LAST_EXIT_CODE=$?; echo -ne "\033]0;${PWD##*/}\007"; [ "$EXPS0" = 0 ] && deleteprompt && echo -e "$(prompt_indicator ${LAST_EXIT_CODE})" || EXPS0=0'
